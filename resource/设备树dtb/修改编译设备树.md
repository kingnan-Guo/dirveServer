# 设备树
使用
sources/linux-rpi-6.6.y/arch/arm/boot/dts/broadcom/bcm2710-rpi-3-b-plus.dts
设备树


编译设备树
make dtbs V=1
fdt 是从  rpi 的 /sys/firmware 复制出来的 放到  /deviceTree 文件夹里
/sys/firmware 下的 fdt 的 dtb 文件
可以反编译

chmod -R 777 fdt


./scripts/dtc/dtc -I dts -O dtb -o tmp.dtb arch/arm/boot/dts/xxx.dts // 编译 dts 为 dtb
./scripts/dtc/dtc -I dtb -O dts -o tmp.dts arch/arm/boot/dts/xxx.dtb // 反编译 dtb 为 dts

反编译 fdt

/opt/sources/linux-rpi-6.6.y/scripts/dtc/dtc -I dtb -O dts -o tmp.dts /opt/github/dirveServer/deviceTree/fdt







# 编译设备树


在
/opt/sources/linux-rpi-6.6.y/scripts/dtc/include-prefixes/arm/broadcom/bcm2710-rpi-3-b-plus.dts

文件下 

/ 添加

    my_board_n@0{
        compatible = "my_board_device,my_drv";
        pin = <GROUP_PIN(3, 1)>;
		data = "2710";
    };
    my_board_n@1{
        compatible = "my_board_device,my_drv";
        pin = <GROUP_PIN(5, 8)>;
		data = "2710";
    };


make ARCH=arm CROSS_COMPILE=aarch64-linux-gnu- clean
make ARCH=arm CROSS_COMPILE=aarch64-linux-gnu- distclean
KERNEL=kernel8
make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- bcm2711_defconfig

make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu-  dtbs  V=1
编译 设备树


我觉得这个也
make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- dtbs -j$(nproc) 

打包出来的 设备树 替换掉 本来的设备树

ls /proc/device-tree/
可以看到 my_board_n@0 和 my_board_n@1

# 查看 platform

在 /sys/devices/platform/ 文件夹下可以看到 创建出来的 platform_device





ls /sys/devices/platform/my_board_n@0/driver

在 
/sys/devices/platform# 中可以看到 
my_board_n@0  my_board_n@1 两个设备树 解析之后得到的 节点


root@raspberrypi:/sys/devices/platform/my_board_n@0# ls -l driver
lrwxrwxrwx 1 root root 0 Mar 16 14:33 driver -> ../../../bus/platform/drivers/my_board_n

# 因为 平台dirver 的 名字 是 my_board_n， 在 my_chip_board_gpio.c 中 my_chip_board_gpio_dirver 的 dirve name

root@raspberrypi:/sys/devices/platform/my_board_n@0# cd ../../../bus/platform/drivers/my_board_n
root@raspberrypi:/sys/bus/platform/drivers/my_board_n# pwd
/sys/bus/platform/drivers/my_board_n


# my_board_n 平台驱动 platform_driver 支持 my_board_n@0  my_board_n@1 这两个设备
root@raspberrypi:/sys/bus/platform/drivers/my_board_n# ls
bind  module  my_board_n@0  my_board_n@1  uevent  unbind







ls /sys/class/gpio/gpio*


