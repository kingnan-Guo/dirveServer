2025/03/21 21:13
    分支
        dirver_raspberry_input_button_v0.1.2

1、中断概念及处理流程

    中断是一种 异常，中断 一般不要持续很长时间
    
    异常向量表
        _start: b reset
        ldr pc, _undefind_instruction
        ldr pc, _software_interrupt
        ldr pc, _prefetch_abort
        ldr pc, _data_abort
        ldr pc, _not_used
        ldr pc, _irq// 发生中断时， cpu 跳到这个地址执行该指令 ，地址为 0x18
        ldr pc, _fiq

    中断向量表的地址
        0x00000000
        0x00000004
        0x00000008
        0x0000000c
        0x00000010
        0x00000014
        0x00000018
        0x0000001c

    异常向量表， 每一条指令对应一种异常
    发生复位时，cpu 跳转到 0x00000000 执行指令，就去执行第一条指令 b reset
    发生未定义指令时，cpu 跳转到 0x00000004 执行指令，就去执行第二条指令 ldr pc, _undefind_instruction
    发生软件中断时，cpu 跳转到 0x00000008 执行指令，就去执行第三条指令 ldr pc, _software_interrupt
    发生预取指令异常时，cpu 跳转到 0x0000000c 执行指令，就去执行第四条指令 ldr pc, _prefetch_abort
    发生数据访问异常时，cpu 跳转到 0x00000010 执行指令，就去执行第五条指令 ldr pc, _data_abort
    发生未使用异常时，cpu 跳转到 0x00000014 执行指令，就去执行第六条指令 ldr pc, _not_used
    发生中断时，cpu 跳转到 0x00000018 执行指令，就去执行第七条指令 ldr pc, _irq
    发生快速中断时，cpu 跳转到 0x0000001c 执行指令，就去执行第八条指令 ldr pc, _fiq

    这些指令存放的位置时固定的， 比如 对于ARM9 芯片 中断向量的地址是0x18
    发生中断时，CPU 就会强制跳去执行 0x18 地址的 代码
    在向量表里， 一般都是放置 一条跳转指令，发生该异常时，CPU 就会 执行向量表中的 跳转指令，去调用更复杂的函数

    当然，向量表的位置并不总是从地址0x00000000开始，很多芯片可以设置某个vector base寄存器 指定向量表在其他位置；
    但表中的哥哥异常向量的偏移地址是固定的， 复位向量偏移地址是 0. 中断时 0x18







2、进程 线程 中断 的核心： 栈

    中断正在运行的进程 线程
![20执行程序的过程](./cpu%20执行程序的过程.png)
    1、在 cpu 中 有 寄存器 , 从栈中读取 a 和 b 的数据， 放到cpu 的寄存器中，将 a 和 b 的数据 在cpu中 相加，将结果保存到 a 再写入到 栈 里
    2、使用汇编指令 将数据读入cpu 的寄存器
    3、当程序执行到中断指令时，cpu 会将当前寄存器的值保存到 栈 中， 保存现场，然后跳转到中断处理程序
    4、中断处理程序执行完毕后，将寄存器的值从 栈 中恢复，然后继续执行被中断的程序


    中断处理程序
![20执行程序的过程](./程序中断执行过程.png)





    在 linux 中 ， 资源分配的单位是进城，调度的单位是线程
        一个进程里 可以有多个线程，这些线程共用 打开的文件句柄、全局变量 等
        线程之间 相互独立 ，同时运行，也就是说，每一个线程 都有自己的栈




3、linux 系统对中断处理的演进
    在linux中，中断是不可以被另一个中断打断的， 没有中断嵌套
    




内核线程